{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/images.service\";\nimport * as i2 from \"../../../../services/users.service\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../../../shared/header-modal/header-modal.component\";\nimport * as i6 from \"../../../../components/avatar-selector/avatar-selector.component\";\nimport * as i7 from \"../../../../components/image-upload/image-upload.component\";\nfunction ImageEditPage_ion_content_1_ion_card_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\")(2, \"app-avatar-selector\", 5);\n    i0.ɵɵlistener(\"avatarSelected\", function ImageEditPage_ion_content_1_ion_card_3_Template_app_avatar_selector_avatarSelected_2_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.user.avatar = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-button\", 6);\n    i0.ɵɵlistener(\"click\", function ImageEditPage_ion_content_1_ion_card_3_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r5.editAvatar());\n    });\n    i0.ɵɵtext(4, \"Guardar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"current\", ctx_r1.user.avatar || \"av1.png\");\n  }\n}\nfunction ImageEditPage_ion_content_1_ion_card_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\")(2, \"app-image-upload\", 7);\n    i0.ɵɵlistener(\"imageSelected\", function ImageEditPage_ion_content_1_ion_card_5_Template_app_image_upload_imageSelected_2_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r6.image = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-button\", 8);\n    i0.ɵɵlistener(\"click\", function ImageEditPage_ion_content_1_ion_card_5_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.editImage());\n    });\n    i0.ɵɵtext(4, \"Guardar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"currentImage\", ctx_r2.user.image);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", !ctx_r2.image);\n  }\n}\nfunction ImageEditPage_ion_content_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-content\", 2)(1, \"ion-slides\", 3)(2, \"ion-slide\");\n    i0.ɵɵtemplate(3, ImageEditPage_ion_content_1_ion_card_3_Template, 5, 1, \"ion-card\", 4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-slide\");\n    i0.ɵɵtemplate(5, ImageEditPage_ion_content_1_ion_card_5_Template, 5, 2, \"ion-card\", 4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"pager\", true);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.user);\n  }\n}\nexport let ImageEditPage = /*#__PURE__*/(() => {\n  class ImageEditPage {\n    constructor(imagesService, usersService, modalCtrl, loadingCtrl) {\n      this.imagesService = imagesService;\n      this.usersService = usersService;\n      this.modalCtrl = modalCtrl;\n      this.loadingCtrl = loadingCtrl;\n      this.viewEntered = false;\n    }\n    ngOnInit() {\n      // console.log(this.user);\n    }\n    ionViewDidEnter() {\n      this.viewEntered = true;\n    }\n    editAvatar() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const loading = yield this.loadingCtrl.create({\n          message: 'Espere por favor...'\n        });\n        yield loading.present();\n        yield this.deleteImage(this.user.image);\n        this.user.image = undefined;\n        this.user.avatar = this.user.avatar || 'av1.png';\n        this.usersService.update(this.user).subscribe(() => {\n          this.loadingCtrl.dismiss();\n          this.modalCtrl.dismiss({\n            update: true\n          });\n        });\n      });\n    }\n    editImage() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const loading = yield this.loadingCtrl.create({\n          message: 'Espere por favor...'\n        });\n        yield loading.present();\n        yield this.deleteImage(this.user.image);\n        this.imagesService.upload(this.image, 'Profiles').subscribe(({\n          uniqueFileName\n        }) => {\n          this.user.image = uniqueFileName;\n          this.user.avatar = undefined;\n          this.usersService.update(this.user).subscribe(() => {\n            this.loadingCtrl.dismiss();\n            this.modalCtrl.dismiss({\n              update: true\n            });\n          });\n        });\n      });\n    }\n    deleteImage(image) {\n      if (!image) {\n        return Promise.resolve();\n      }\n      return this.imagesService.delete(image, 'Profiles').toPromise();\n    }\n  }\n  ImageEditPage.ɵfac = function ImageEditPage_Factory(t) {\n    return new (t || ImageEditPage)(i0.ɵɵdirectiveInject(i1.ImageService), i0.ɵɵdirectiveInject(i2.UsersService), i0.ɵɵdirectiveInject(i3.ModalController), i0.ɵɵdirectiveInject(i3.LoadingController));\n  };\n  ImageEditPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ImageEditPage,\n    selectors: [[\"app-image-edit\"]],\n    inputs: {\n      user: \"user\"\n    },\n    decls: 2,\n    vars: 1,\n    consts: [[\"title\", \"Cambiar imagen\"], [\"class\", \"ion-padding\", \"color\", \"light\", 4, \"ngIf\"], [\"color\", \"light\", 1, \"ion-padding\"], [3, \"pager\"], [4, \"ngIf\"], [3, \"current\", \"avatarSelected\"], [\"color\", \"tertiary\", 3, \"click\"], [3, \"currentImage\", \"imageSelected\"], [\"color\", \"tertiary\", 3, \"disabled\", \"click\"]],\n    template: function ImageEditPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"app-header-modal\", 0);\n        i0.ɵɵtemplate(1, ImageEditPage_ion_content_1_Template, 6, 3, \"ion-content\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.viewEntered);\n      }\n    },\n    dependencies: [i4.NgIf, i3.IonButton, i3.IonCard, i3.IonCardContent, i3.IonContent, i3.IonSlide, i3.IonSlides, i5.HeaderModalComponent, i6.AvatarSelectorComponent, i7.ImageUploadComponent],\n    styles: [\"ion-slides[_ngcontent-%COMP%], ion-slide[_ngcontent-%COMP%]{width:100%;height:100%;background-color:#f4f5f8}ion-card[_ngcontent-%COMP%]{width:80%}\"]\n  });\n  return ImageEditPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}