{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/users.service\";\nimport * as i2 from \"../../services/password-recovery.service\";\nimport * as i3 from \"./../../services/toast.service\";\nimport * as i4 from \"@ionic/angular\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nconst _c0 = [\"slides\"];\nfunction PasswordRecoveryPage_small_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 22);\n    i0.ɵɵtext(1, \"none\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PasswordRecoveryPage_small_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 23);\n    i0.ɵɵtext(1, \" El correo es \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"requerido\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PasswordRecoveryPage_small_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 23);\n    i0.ɵɵtext(1, \" Formato de correo inv\\u00E1lido \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PasswordRecoveryPage_small_42_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 22);\n    i0.ɵɵtext(1, \"none\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PasswordRecoveryPage_small_43_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 23);\n    i0.ɵɵtext(1, \" La contrase\\u00F1a es \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"requerida\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction PasswordRecoveryPage_small_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 23);\n    i0.ɵɵtext(1, \" La contrase\\u00F1a es demasiado corta \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PasswordRecoveryPage_small_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 22);\n    i0.ɵɵtext(1, \"none\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PasswordRecoveryPage_small_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 23);\n    i0.ɵɵtext(1, \" Las contrase\\u00F1as no \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3, \"coinciden\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let PasswordRecoveryPage = /*#__PURE__*/(() => {\n  class PasswordRecoveryPage {\n    constructor(usersService, passwordRecoveryService, toastService, loadingCtrl, router, route) {\n      this.usersService = usersService;\n      this.passwordRecoveryService = passwordRecoveryService;\n      this.toastService = toastService;\n      this.loadingCtrl = loadingCtrl;\n      this.router = router;\n      this.route = route;\n      this.slidesOpts = {\n        allowTouchMove: false,\n        speed: 400\n      };\n    }\n    ngOnInit() {\n      this.route.params.subscribe(({\n        token\n      }) => {\n        if (token) {\n          this.token = token;\n          this.verifyToken();\n        }\n      });\n    }\n    validateEmail() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const loading = yield this.loadingCtrl.create({\n          message: 'Espere por favor...'\n        });\n        yield loading.present();\n        this.usersService.findByEmail(this.email).subscribe(user => {\n          loading.dismiss();\n          if (!user) {\n            this.toastService.presentToast({\n              message: 'El correo no corresponde a ningún usuario del sistema',\n              duration: 2000\n            });\n          } else {\n            this.passwordRecoveryService.create({\n              email: this.email\n            }).subscribe(_ => {\n              this.toastService.presentToast({\n                message: 'Se ha enviado un código de verificación al correo',\n                duration: 2000\n              });\n            });\n          }\n        });\n      });\n    }\n    verifyToken() {\n      this.passwordRecoveryService.find(this.token).subscribe(({\n        email\n      }) => {\n        this.email = email;\n        this.slides.slideNext();\n      }, err => {\n        if (err.status === 404) {\n          this.toastService.presentToast({\n            message: err.error.message,\n            duration: 2000\n          });\n        }\n      });\n    }\n    changePassword() {\n      this.usersService.findByEmail(this.email).subscribe(user => {\n        user.password = this.password;\n        this.usersService.update(user).subscribe(_ => {\n          this.toastService.presentToast({\n            message: 'La contraseña ha sido cambiada exitosamente!',\n            duration: 2000\n          });\n          this.router.navigateByUrl('/login');\n        });\n      });\n    }\n  }\n  PasswordRecoveryPage.ɵfac = function PasswordRecoveryPage_Factory(t) {\n    return new (t || PasswordRecoveryPage)(i0.ɵɵdirectiveInject(i1.UsersService), i0.ɵɵdirectiveInject(i2.PasswordRecoveryService), i0.ɵɵdirectiveInject(i3.ToastService), i0.ɵɵdirectiveInject(i4.LoadingController), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i5.ActivatedRoute));\n  };\n  PasswordRecoveryPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PasswordRecoveryPage,\n    selectors: [[\"app-password-recovery\"]],\n    viewQuery: function PasswordRecoveryPage_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.slides = _t.first);\n      }\n    },\n    decls: 56,\n    vars: 14,\n    consts: [[\"color\", \"light\"], [\"slot\", \"start\"], [\"defaultHref\", \"/login\"], [\"scroll-y\", \"false\", \"color\", \"light\", 3, \"fullscreen\"], [1, \"slide-full\", 3, \"options\"], [\"slides\", \"\"], [1, \"ion-justify-content-center\"], [\"size-md\", \"4\", \"size-sm\", \"8\", \"size-xs\", \"10\"], [\"position\", \"floating\"], [\"name\", \"mail\", \"slot\", \"start\", 1, \"ion-align-self-center\"], [\"type\", \"text\", \"email\", \"\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"emailModel\", \"ngModel\"], [2, \"text-align\", \"left\"], [\"style\", \"visibility: hidden;\", 4, \"ngIf\"], [\"class\", \"text-danger\", 4, \"ngIf\"], [\"expand\", \"full\", \"color\", \"primary\", 3, \"disabled\", \"click\"], [\"name\", \"key\", \"slot\", \"start\", 1, \"ion-align-self-center\"], [\"type\", \"password\", \"required\", \"\", \"minlength\", \"6\", 3, \"ngModel\", \"ngModelChange\"], [\"passwordModel\", \"ngModel\"], [\"type\", \"password\", \"required\", \"\", 3, \"ngModel\", \"ngModelChange\"], [\"confirmModel\", \"ngModel\"], [\"color\", \"primary\", \"expand\", \"full\", \"type\", \"button\", 3, \"disabled\", \"click\"], [2, \"visibility\", \"hidden\"], [1, \"text-danger\"]],\n    template: function PasswordRecoveryPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-buttons\", 1);\n        i0.ɵɵelement(3, \"ion-back-button\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Recuperaci\\u00F3n de contrase\\u00F1a\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(6, \"ion-content\", 3)(7, \"ion-slides\", 4, 5)(9, \"ion-slide\")(10, \"ion-grid\")(11, \"ion-row\", 6)(12, \"ion-col\", 7)(13, \"ion-card\")(14, \"ion-card-content\")(15, \"ion-list\")(16, \"ion-item\")(17, \"ion-label\", 8);\n        i0.ɵɵtext(18, \"Correo electr\\u00F3nico\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(19, \"ion-icon\", 9);\n        i0.ɵɵelementStart(20, \"ion-input\", 10, 11);\n        i0.ɵɵlistener(\"ngModelChange\", function PasswordRecoveryPage_Template_ion_input_ngModelChange_20_listener($event) {\n          return ctx.email = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(22, \"div\", 12);\n        i0.ɵɵtemplate(23, PasswordRecoveryPage_small_23_Template, 2, 0, \"small\", 13);\n        i0.ɵɵtemplate(24, PasswordRecoveryPage_small_24_Template, 4, 0, \"small\", 14);\n        i0.ɵɵtemplate(25, PasswordRecoveryPage_small_25_Template, 2, 0, \"small\", 14);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(26, \"ion-button\", 15);\n        i0.ɵɵlistener(\"click\", function PasswordRecoveryPage_Template_ion_button_click_26_listener() {\n          return ctx.validateEmail();\n        });\n        i0.ɵɵtext(27, \"Solicitar\");\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵelementStart(28, \"ion-slide\")(29, \"ion-grid\")(30, \"ion-row\", 6)(31, \"ion-col\", 7)(32, \"ion-card\")(33, \"ion-card-content\")(34, \"ion-list\")(35, \"ion-item\")(36, \"ion-label\", 8);\n        i0.ɵɵtext(37, \"Nueva contrase\\u00F1a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(38, \"ion-icon\", 16);\n        i0.ɵɵelementStart(39, \"ion-input\", 17, 18);\n        i0.ɵɵlistener(\"ngModelChange\", function PasswordRecoveryPage_Template_ion_input_ngModelChange_39_listener($event) {\n          return ctx.password = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(41, \"div\", 12);\n        i0.ɵɵtemplate(42, PasswordRecoveryPage_small_42_Template, 2, 0, \"small\", 13);\n        i0.ɵɵtemplate(43, PasswordRecoveryPage_small_43_Template, 4, 0, \"small\", 14);\n        i0.ɵɵtemplate(44, PasswordRecoveryPage_small_44_Template, 2, 0, \"small\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(45, \"ion-item\")(46, \"ion-label\", 8);\n        i0.ɵɵtext(47, \"Confirmar contrase\\u00F1a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(48, \"ion-icon\", 16);\n        i0.ɵɵelementStart(49, \"ion-input\", 19, 20);\n        i0.ɵɵlistener(\"ngModelChange\", function PasswordRecoveryPage_Template_ion_input_ngModelChange_49_listener($event) {\n          return ctx.confirmPassword = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(51, \"div\", 12);\n        i0.ɵɵtemplate(52, PasswordRecoveryPage_small_52_Template, 2, 0, \"small\", 13);\n        i0.ɵɵtemplate(53, PasswordRecoveryPage_small_53_Template, 4, 0, \"small\", 14);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(54, \"ion-button\", 21);\n        i0.ɵɵlistener(\"click\", function PasswordRecoveryPage_Template_ion_button_click_54_listener() {\n          return ctx.changePassword();\n        });\n        i0.ɵɵtext(55, \"Actualizar\");\n        i0.ɵɵelementEnd()()()()()()()()();\n      }\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(21);\n        const _r5 = i0.ɵɵreference(40);\n        const _r9 = i0.ɵɵreference(50);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"options\", ctx.slidesOpts);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngModel\", ctx.email);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", _r1.pristine || _r1.valid);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", _r1.dirty && _r1.hasError(\"required\"));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", _r1.dirty && _r1.hasError(\"email\"));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", _r1.invalid);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngModel\", ctx.password);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", _r5.pristine || _r5.valid);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", _r5.dirty && _r5.hasError(\"required\"));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", _r5.dirty && _r5.hasError(\"minlength\"));\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.confirmPassword);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", _r9.pristine || _r9.valid);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", _r9.dirty && _r5.value !== _r9.value);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", _r5.invalid || _r5.value !== _r9.value);\n      }\n    },\n    dependencies: [i6.NgIf, i7.NgControlStatus, i7.RequiredValidator, i7.MinLengthValidator, i7.EmailValidator, i7.NgModel, i4.IonBackButton, i4.IonButton, i4.IonButtons, i4.IonCard, i4.IonCardContent, i4.IonCol, i4.IonContent, i4.IonGrid, i4.IonHeader, i4.IonIcon, i4.IonInput, i4.IonItem, i4.IonLabel, i4.IonList, i4.IonRow, i4.IonSlide, i4.IonSlides, i4.IonTitle, i4.IonToolbar, i4.TextValueAccessor, i4.IonBackButtonDelegate],\n    styles: [\".slide-full[_ngcontent-%COMP%]{height:100%!important}\"]\n  });\n  return PasswordRecoveryPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}